<!DOCTYPE html>
<html lang="fr">
  <head>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='SmartRH.png') }}" />
    <meta charset="UTF-8" />
    <title>Créer un appel à candidature</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Cache la flèche sur les champs de type date */
      input[type="date"]::-webkit-inner-spin-button,
      input[type="date"]::-webkit-calendar-picker-indicator {
        display: none;
        -webkit-appearance: none;
      }
      .ql-container {
          border-bottom-left-radius: 0.5rem;
          border-bottom-right-radius: 0.5rem;
          min-height: 10rem;
      }
      .ql-toolbar.ql-snow {
          border-top-left-radius: 0.5rem;
          border-top-right-radius: 0.5rem;
          border-color: #e5e7eb;
      }
    </style>
  </head>
  
  <body class="bg-gray-50 text-gray-800 font-sans leading-normal antialiased">
    <header class="flex justify-between items-center px-6 py-4 bg-white shadow-lg sticky top-0 z-50">
      <div class="flex items-center space-x-4">
        <img src="{{ url_for('static', filename='SmartRH.png') }}" alt="Logo SmartRH" class="h-12 w-auto" />
        <h1 class="text-2xl font-extrabold text-green-700 hidden md:block">
          ESPACE D’APPEL À CANDIDATURE
        </h1>
      </div>
      
      <div class="relative inline-block text-left" x-data="{ open: false }">
        <div>
          <button
            @click="open = !open"
            type="button"
            class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 transition-colors duration-200"
            id="menu-button"
            aria-expanded="true"
            aria-haspopup="true"
            aria-label="Menu utilisateur"
          >
            <i class="fas fa-user-circle fa-2x"></i>
          </button>
        </div>

        <div
          x-show="open"
          @click.away="open = false"
          x-transition:enter="transition ease-out duration-100"
          x-transition:enter-start="transform opacity-0 scale-95"
          x-transition:enter-end="transform opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-75"
          x-transition:leave-start="transform opacity-100 scale-100"
          x-transition:leave-end="transform opacity-0 scale-95"
          class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50"
          role="menu"
          aria-orientation="vertical"
          aria-labelledby="menu-button"
          tabindex="-1"
        >
          <div class="py-1" role="none">
            <div class="px-4 py-2 text-sm text-gray-700 border-b border-gray-100">
              <p class="font-semibold">{{ current_user.prenom }} {{ current_user.nom }}</p>
              <p class="text-xs text-gray-500">{{ current_user.entreprise }}</p>
            </div>
            
            <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100 transition-colors duration-200" role="menuitem" tabindex="-1" id="menu-item-0">
              <i class="fas fa-user mr-2"></i>Profil
            </a>
            <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100 transition-colors duration-200" role="menuitem" tabindex="-1" id="menu-item-1">
              <i class="fas fa-cog mr-2"></i>Paramètres
            </a>
            <form method="POST" action="{{ url_for('auth.logout') }}" role="none">
              <button
                type="submit"
                class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-red-50 hover:text-red-700 transition-colors duration-200"
                role="menuitem"
                tabindex="-1"
                id="menu-item-2"
              >
                <i class="fas fa-sign-out-alt mr-2"></i>Se déconnecter
              </button>
            </form>
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto mt-12 p-6">
      <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
          <h2 class="text-4xl font-extrabold text-gray-900 flex items-center space-x-3">
            <i class="fas fa-bullhorn text-green-600"></i>
            <span>Créer un nouvel appel</span>
          </h2>
          <a
            href="{{ url_for('appel.appel_home') }}"
            class="bg-gray-200 text-gray-700 px-5 py-2.5 rounded-full shadow-md font-bold hover:bg-gray-300 transition-all duration-300 transform hover:scale-105 flex items-center space-x-2"
          >
            <i class="fas fa-arrow-left"></i>
            <span>Retour au dashboard</span>
          </a>
        </div>

        <div class="bg-white shadow-2xl rounded-3xl p-8 md:p-12">
          <form method="POST" class="space-y-8">
            <div class="space-y-4">
              <div class="relative">
                <label for="titre" class="block text-sm font-semibold mb-2 text-gray-700">Nom de l'appel</label>
                <input
                  type="text"
                  name="titre"
                  id="titre"
                  class="w-full border border-gray-300 rounded-xl px-5 py-3 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200 placeholder-gray-400"
                  placeholder="Ex: Développeur Full Stack"
                  required
                />
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="relative">
                  <label for="date_debut" class="block text-sm font-semibold mb-2 text-gray-700">Date de début</label>
                  <input
                    type="date"
                    name="date_debut"
                    id="date_debut"
                    class="w-full border border-gray-300 rounded-xl px-5 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200"
                    required
                  />
                  <i class="fas fa-calendar-alt text-gray-400 absolute right-5 top-1/2 mt-2 -translate-y-1/2 pointer-events-none"></i>
                </div>
                <div class="relative">
                  <label for="date_fin" class="block text-sm font-semibold mb-2 text-gray-700">Date de fin</label>
                  <input
                    type="date"
                    name="date_fin"
                    id="date_fin"
                    class="w-full border border-gray-300 rounded-xl px-5 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200"
                    required
                  />
                  <i class="fas fa-calendar-alt text-gray-400 absolute right-5 top-1/2 mt-2 -translate-y-1/2 pointer-events-none"></i>
                </div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold mb-2 text-gray-700">Description de l'offre</label>
              <div id="editor" class="bg-white h-40 border border-gray-300 rounded-xl"></div>
              <input type="hidden" name="description" id="description" />
            </div>
            
            <div class="space-y-6">
                <div class="flex justify-between items-center">
                    <label class="block text-sm font-semibold text-gray-700">Critères & Scores</label>
                    <button
                        type="button"
                        onclick="addCritere()"
                        class="text-green-600 font-medium hover:text-green-800 transition-colors duration-200 flex items-center space-x-2"
                    >
                        <i class="fas fa-plus-circle"></i>
                        <span>Ajouter un critère</span>
                    </button>
                </div>
                <div id="criteres-container" class="space-y-4">
                  <div class="flex items-center space-x-4">
                    <input
                      type="text"
                      name="intitule[]"
                      placeholder="Ex: Python"
                      class="flex-1 border border-gray-300 rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200"
                      required
                    />
                    <input
                      type="number"
                      name="score[]"
                      placeholder="Score"
                      min="1"
                      value="1"
                      class="w-24 border border-gray-300 rounded-xl px-4 py-2 text-center focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200"
                    />
                    <button
                        type="button"
                        onclick="this.parentNode.remove()"
                        class="text-gray-400 hover:text-red-500 transition-colors duration-200"
                        title="Supprimer ce critère"
                      >
                        <i class="fas fa-trash-alt"></i>
                    </button>
                  </div>
                </div>
            </div>

            <button
              type="submit"
              class="w-full bg-green-600 text-white font-bold px-6 py-4 rounded-xl shadow-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-3 mt-10"
            >
              <i class="fas fa-link fa-lg"></i>
              <span>GÉNÉRER LE LIEN DU FORMULAIRE</span>
            </button>
          </form>

          {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
          <div class="mt-8 space-y-4">
            {% for category, message in messages %}
            <div
              class="flex items-center p-5 rounded-xl shadow-lg text-sm {% if category == 'success' %}bg-green-100 text-green-700{% else %}bg-red-100 text-red-700{% endif %}"
              role="alert"
            >
              <div class="mr-3">
                {% if category == 'success' %}
                <i class="fas fa-check-circle fa-lg"></i>
                {% else %}
                <i class="fas fa-exclamation-triangle fa-lg"></i>
                {% endif %}
              </div>
              <div>
                <strong class="font-bold">{{ message }}</strong>
              </div>
            </div>
            {% endfor %}
          </div>
          {% endif %}
          {% endwith %}
        </div>
      </div>
    </main>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
      const quill = new Quill("#editor", {
        theme: "snow",
        placeholder: "Décrivez les compétences, les responsabilités et les qualifications requises pour ce poste...",
        modules: {
          toolbar: [
            ["bold", "italic", "underline"],
            [{ list: "ordered" }, { list: "bullet" }],
            ["blockquote", "clean"],
          ],
        },
      });

    document.querySelector("form").addEventListener("submit", function () {
        const htmlContent = quill.root.innerHTML.trim();
        // Gérer le cas où l'éditeur est vide
        if (htmlContent === "" || htmlContent === "<p><br></p>") {
            document.querySelector("#description").value = "Aucune description fournie.";
        } else {
            document.querySelector("#description").value = htmlContent;
        }
    });
    </script>
    <script>
      function addCritere() {
        const container = document.getElementById('criteres-container');
        const wrapper = document.createElement('div');
        wrapper.className = 'flex items-center space-x-4';

        const inputIntitule = document.createElement('input');
        inputIntitule.type = 'text';
        inputIntitule.name = 'intitule[]';
        inputIntitule.placeholder = 'Ex: Django';
        inputIntitule.className = 'flex-1 border border-gray-300 rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200';
        inputIntitule.required = true;

        const inputScore = document.createElement('input');
        inputScore.type = 'number';
        inputScore.name = 'score[]';
        inputScore.placeholder = 'Score';
        inputScore.min = '1';
        inputScore.value = '1';
        inputScore.className = 'w-24 border border-gray-300 rounded-xl px-4 py-2 text-center focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200';

        const deleteButton = document.createElement('button');
        deleteButton.type = 'button';
        deleteButton.className = 'text-gray-400 hover:text-red-500 transition-colors duration-200';
        deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
        deleteButton.onclick = function() {
          wrapper.remove();
        };

        wrapper.appendChild(inputIntitule);
        wrapper.appendChild(inputScore);
        wrapper.appendChild(deleteButton);

        container.appendChild(wrapper);
      }
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  </body>
</html>